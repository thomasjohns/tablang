module: definition* EOF

definition: transform | test

transform: '{' rule_block* '}' NEWLINE+

rule_block: alias_block | header_block | value_block

alias_block: '{' alias_rule* '}' NEWLINE+
alias_rule: NAME EQ literal NEWLINE+

header_block: '{' header_rule* '}' NEWLINE+
header_rule: (NAME | literal) '->' (single_line_pipeline | multi_line_pipeline)

value_block: '{' value_rule* '}' NEWLINE+
value_rule: (NAME | literal) '->' (single_line_pipeline | multi_line_pipeline)

multi_line_pipeline: '{' single_line_pipeline* '}' NEWLINE+
single_line_pipeline: pipeline NEWLINE+
pipeline: '|'? function ('|' function)* '|'? NEWLINE+
function: NAME argument*
argument: NAME | literal

literal: STRING | NUMBER | PATTERN
